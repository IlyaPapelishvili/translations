# Выпуск Rust 1.43.0: улучшение производительности компилятора и вывода типов для примитивов, item в макросах

Команда Rust рада сообщить о выпуске новой версии, 1.43.0. Rust — это язык программирования, позволяющий каждому создавать надёжное и эффективное программное обеспечение.

Если вы установили предыдущую версию Rust средствами `rustup`, то для обновления до версии 1.43.0 вам достаточно выполнить следующую команду:

```console
rustup update stable
```

Если у вас ещё не установлен `rustup`, вы можете [установить его] с соответствующей страницы нашего веб-сайта, а также посмотреть [подробные примечания к выпуску] на GitHub.

## Что вошло в стабильную версию 1.43.0

Значительных изменений и нововведений этот релиз не содержит. Мы стабилизировали несколько новых API, улучшили производительность компилятора и добавили некоторые изменения в систему макросов. Для более подробной информации смотрите [подробные примечания к выпуску](https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1430-2020-04-23).

### Фрагменты `item`

Теперь вы можете использовать фрагменты `item`, встраивая их в тело типажей, реализаций или внешних блоков. Например:

```rust
macro_rules! mac_trait {
    ($i:item) => {
        trait T { $i }
    }
}
mac_trait! {
    fn foo() {}
}
```

Этот вызов сгенерирует следующий код:

```rust
trait T {
    fn foo() {}
}
```

### Вывод типов для примитивов

Был улучшен вывод типов для примитивов, ссылок и бинарных операций. Например, следующий код не компилируется в Rust 1.42, но соберётся в Rust 1.43.

```rust
let n: f32 = 0.0 + &0.0;
```

Rust 1.42 выдаёт ошибку "casting `&f64` as `f32` is invalid - cannot cast `&f64` as `f32`". Начиная с этого выпуска алгоритм правильно выводит тип операндов - `f32`.

### Новая переменная окружения Cargo для тестов

Чтобы помочь в проведении интеграционного тестирования, [Cargo теперь устанавливает новую переменную окружения](https://github.com/rust-lang/cargo/pull/7697).

Это легче всего объяснить на примере: допустим, мы работаем над консольным проектом, назовём его "cli". В интеграционных тестах мы хотим запустить `cli` и посмотреть на результат её работы. Во время выполнения тестов и бенчмарков Cargo устанавливает переменную окружения с именем `CARGO_BIN_EXE_cli`, и мы можем использовать её в нашем тесте:

```rust
let exe = env!("CARGO_BIN_EXE_cli");
```

`cli` становится легче вызвать, ведь теперь у нас в распоряжении его полный путь.

### Изменения в библиотеке

[Мы можем напрямую использовать константы, ассоциированные с целыми числами и числами с плавающей точкой], вместо того, чтобы импортировать модуль. Теперь мы можем писать `u32::MAX` или `f32::NAN` без `use std::u32;` и `use std::f32;`.

Также добавлен [новый модуль `primitive`](https://github.com/rust-lang/rust/pull/67637/), реэкспортирующий примитивные типы Rust. Он может пригодиться в написании макросов, чтобы быть уверенным, что типы не будут затенены.

Ещё мы стабилизировали шесть новых API:

- [`Once::is_completed`]
- [`f32::LOG10_2`]
- [`f32::LOG2_10`]
- [`f64::LOG10_2`]
- [`f64::LOG2_10`]
- [`iter::once_with`]

### Другие изменения

[Синтаксис](https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1430-2020-04-23), [пакетный менеджер Cargo] и [анализатор Clippy] также претерпели некоторые изменения.

## Участники 1.43.0

Множество людей собрались вместе, чтобы создать Rust 1.43.0. Мы не смогли бы сделать это без всех вас, [спасибо](https://thanks.rust-lang.org/rust/1.43.0/)!


[установить его]: https://www.rust-lang.org/install.html
[подробные примечания к выпуску]: https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1430-2020-04-23
[Мы можем напрямую использовать константы, ассоциированные с целыми числами и числами с плавающей точкой]: https://github.com/rust-lang/rust/pull/68952/
[`Once::is_completed`]: https://doc.rust-lang.org/std/sync/struct.Once.html#method.is_completed
[`f32::LOG10_2`]: https://doc.rust-lang.org/std/f32/consts/constant.LOG10_2.html
[`f32::LOG2_10`]: https://doc.rust-lang.org/std/f32/consts/constant.LOG2_10.html
[`f64::LOG10_2`]: https://doc.rust-lang.org/std/f64/consts/constant.LOG10_2.html
[`f64::LOG2_10`]: https://doc.rust-lang.org/std/f64/consts/constant.LOG2_10.html
[`iter::once_with`]: https://doc.rust-lang.org/std/iter/fn.once_with.html
[пакетный менеджер Cargo]: https://github.com/rust-lang/cargo/blob/master/CHANGELOG.md#cargo-143-2020-04-23
[анализатор Clippy]: https://github.com/rust-lang/rust-clippy/blob/master/CHANGELOG.md#rust-143
